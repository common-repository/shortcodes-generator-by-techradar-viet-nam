!function(t){"use strict";t.zfshortcode=t.zfshortcode||{};var e=t("#zf-shortcode-popup");t.zfshortcode.init_popup=function(){t(".zf-insert-shortcode-button").magnificPopup({type:"inline",removalDelay:500,mainClass:"mfp-zoom-out",fixedContentPos:"auto",callbacks:{beforeOpen:function(){}},midClick:!0}),t(".zf-shortcode-list ul li").click(function(){var e=t(this).attr("data-tab");t(".zf-shortcode-list ul li").removeClass("sc-current"),t(".zf-shortcode-content").removeClass("sc-current"),t(this).addClass("sc-current"),t("#"+e).addClass("sc-current")}),t(".zf-menu-shortcodes").on("click",function(){t(".zf-popup-content").toggleClass("move-right")}),t(".content-right").on("click",function(){t(".zf-popup-content").removeClass("move-right")});var i=t(".content-left",e);t("#filter-by-type").on("change",function(){var e=t(this).val();"all"==e?t(".zf-shortcode-list .zf-shortcode-tab",i).show():t(".zf-shortcode-list .zf-shortcode-tab",i).each(function(){t(this).attr("data-filter")==e?t(this).show():t(this).hide()})})},t.zfshortcode.resize_popup=function(){var i=t(window).height();t(".zf-popup-content .content-right",e).css({height:i-256})},t.zfshortcode.init_content=function(){t(".zf-shortcode-content").each(function(){var e=t(this),i=t("#items",e);if(i.length){var a=i.tabs({closable:!0});a.find(" > .ui-tabs-nav").sortable({stop:function(){a.tabs("refresh")}});var n=2,o=2;t("#button-add-item",e).on("click",function(s){s.preventDefault();var r=i.find(" > .ui-tabs-nav .ui-tabs-active").first(),c=r.attr("aria-controls"),f=r.find(" > a").data("tab-title"),l="<li><a href='#item-"+o+"' data-tab-title='"+f+"'>"+f+"</a><span class='ui-icon ui-icon-close' role='presentation'></span></li>";a.find(".zf-element-tabs").tabs("destroy");var d=t(l);d.find("a").append("<span> #"+n+"</span>"),n++,a.find("> .ui-tabs-nav").append(d);var h=t("<div></div>",{id:"item-"+o});h.append(t("#"+c,e).html()),h.find(".wp-picker-container").each(function(){var e=t(this).parent(),i=t(this).find(".zf-color-picker").clone();e.append(i),t(this).remove();var a=i.attr("id");t("#"+a,e).wpColorPicker()}),h.find(".zf-radio-field").each(function(){var e=t(this).attr("data-field"),i=e+t.now();t(this).find('input[type="radio"]').attr("name",i)}),t.zfshortcode.init_element_media(h),t.zfshortcode.init_icon(h),a.append(h),a.tabs("refresh"),a.find(".zf-element-tabs").tabs(),o++}),a.delegate("span.ui-icon-close","click",function(e){if(e.preventDefault(),a.find("> .ui-tabs-nav li").length<2)return alert(zf_shortcode_var.remove_tab),!1;var i=t(this).closest("li").remove().attr("aria-controls");t("#"+i).remove(),a.tabs("refresh")})}t(".zf-element-tabs",e).length&&t(".zf-element-tabs",e).tabs()})},t.zfshortcode.send_to_editor=function(){t("#insert-shortcode",e).click(function(e){e.preventDefault();var i=[],a=[],n="",o=t(".content-right .sc-current");t("#parent-shortcode .zf-field",o).each(function(){var e=t(this);if(e.hasClass("is-content"))n=e.val();else if(e.hasClass("zf-spacing-field")){var a=e.find("#spacing-type").val(),o="";e.find('input[type="text"]').each(function(){""!=t(this).val()&&(o+=t(this).attr("name").replace("spacing-","")+":"+t(this).val()+a+" ")}),o=o.trim().replace(/\s/g,"|"),""!=o&&i.push(e.attr("data-field")+'="'+o+'"')}else if(e.hasClass("zf-radio-field")){var s=e.find('input[type="radio"]:checked');""!=s.val()&&i.push(e.attr("data-field")+'="'+s.val()+'"')}else if(e.hasClass("zf-column-responsive-field")){var r="";e.find(".zf-device-row").each(function(){var e=t(this).attr("data-device"),i=t(this).find(".responsive-column-offset").val(),a=t(this).find(".responsive-column-hidden").is(":checked"),n=t(this).find(".responsive-column-size");n=n.length>0?n.val():"";var o=""!=n?" col-"+e+"-"+n:"",s=""!=i?" col-"+e+"-"+i:"",c=a?" hidden-"+e:"";r+=o+s+c}),""!=r&&i.push(e.attr("data-field")+'="'+r.trim()+'"')}else""!=e.val()&&i.push(e.attr("name")+'="'+e.val()+'"')});var s=t("#child-shortcode #items",o);if(s.length>0){var r=[];s.find("> ul > li a").each(function(){var e=t(this).parent().attr("aria-controls");r.push(e)}),r.length>0&&t.each(r,function(e,i){var n=[],s="",r="";t("#"+i+" .zf-field",o).each(function(){var e=t(this);if(e.hasClass("is-content"))r=e.val();else if(e.hasClass("zf-spacing-field")){var i=e.find("#spacing-type").val(),a="";e.find('input[type="text"]').each(function(){""!=t(this).val()&&(a+=t(this).attr("name").replace("spacing-","")+":"+t(this).val()+i+" ")}),a=a.trim().replace(/\s/g,"|"),""!=a&&n.push(e.attr("data-field")+'="'+a+'"')}else if(e.hasClass("zf-radio-field")){var o=e.find('input[type="radio"]:checked');""!=o.val()&&n.push(e.attr("data-field")+'="'+o.val()+'"')}else if(e.hasClass("zf-column-responsive-field")){var s="";e.find(".zf-device-row").each(function(){var e=t(this).attr("data-device"),i=t(this).find(".responsive-column-offset").val(),a=t(this).find(".responsive-column-hidden").is(":checked"),n=t(this).find(".responsive-column-size");n=n.length>0?n.val():"";var o=""!=n?" col-"+e+"-"+n:"",r=""!=i?" col-"+e+"-"+i:"",c=a?" hidden-"+e:"";s+=o+r+c}),""!=s&&n.push(e.attr("data-field")+'="'+s.trim()+'"')}else""!=e.val()&&n.push(e.attr("name")+'="'+e.val()+'"')}),n.length>0&&(s=" "+n.join(" ").trim()),a.push({attrs:s,content:r})})}var c=t("#zf_shortcode",o).val(),f=t("#zf_child_shortcode",o).val(),l=t("#zf_has_child",o).val(),d="",h="";if(i.length>0&&(h=" "+i.join(" ").trim()),l){var p="";a.length>0&&(t.each(a,function(t,e){var i=f;p+=i.replace("{{attributes}}",e.attrs).replace("{{content}}",e.content)+"<br>"}),n="<br>"+p)}d=c.replace("{{attributes}}",h).replace("{{content}}",n),""!=d&&(t.magnificPopup.close(),window.send_to_editor(d))})},t.zfshortcode.reset_fields=function(){t("#reset-shortcode",e).on("click",function(i){i.preventDefault(),t(".content-right .zf-field",e).each(function(){var e=t(this);if(e.hasClass("zf-radio-field"))e.find('input[value="'+e.attr("data-reset")+'"]').attr("checked",!0);else if(e.hasClass("zf-spacing-field"))e.find("#spacing-top").val(e.attr("data-top")),e.find("#spacing-right").val(e.attr("data-right")),e.find("#spacing-bottom").val(e.attr("data-bottom")),e.find("#spacing-left").val(e.attr("data-left")),e.find("#spacing-type").val(e.attr("data-type"));else{var i=e.attr("data-reset");if(e.hasClass("zf-icon-field")){var a=e.parent();a.find(".zf-font-awesomefont").removeClass("selected"),""!=i&&a.find(".fa-"+i).closest(".zf-font-awesomefont").addClass("selected")}e.val(i)}})})},t.zfshortcode.fields=function(){t(".zf-shortcode-content").each(function(){var e=t(this);t.zfshortcode.init_color(e),t.zfshortcode.init_element_media(e),t.zfshortcode.init_icon(e)})},t.zfshortcode.init_icon=function(e){t(".zf-font-awesomefont a",e).on("click",function(e){e.preventDefault();var i=t(this).parent(),a=t(this).closest(".zf-icon-field-container");i.hasClass("selected")?(i.removeClass("selected"),a.find('input[type="hidden"]').val("")):(a.find(".zf-font-awesomefont").removeClass("selected"),i.addClass("selected"),a.find('input[type="hidden"]').val(t(this).attr("href")))}),t(".zf-icon-field",e).each(function(){var e=t(this);if(""!=e.val()){var i=e.parent();i.find(".fa-"+e.val()).closest(".zf-font-awesomefont").addClass("selected")}})},t.zfshortcode.init_color=function(e){t(".zf-color-picker",e).each(function(){var i=t(this),a=i.attr("id");t("#"+a,e).wpColorPicker()})},t.zfshortcode.init_element_media=function(e){t(".zf-upload-image",e).on("click",function(e){e.preventDefault();var i=t(this),a=i.attr("data-field");t.zfshortcode.upload_media(a,i.parent())})},t.zfshortcode.upload_media=function(e,i){var a=wp.media({title:"Insert a media",library:{type:"image"},multiple:!1,button:{text:"Insert"}});return a.on("select",function(){var n=a.state().get("selection").first().toJSON();t("#"+e,i).val(n.url)}),a.open(),!1},t(document).ready(function(){t.zfshortcode.init_popup(),t.zfshortcode.resize_popup(),t(window).on("resize",function(){t.zfshortcode.resize_popup()}),t.zfshortcode.init_content(),t.zfshortcode.fields(),t.zfshortcode.send_to_editor(),t.zfshortcode.reset_fields()})}(jQuery);